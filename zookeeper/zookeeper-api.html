<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>ZooKeeper Java API | BIGDATA-TUTORIAL</title>
    <meta name="generator" content="VuePress 1.5.2">
    <link rel="icon" href="/bigdata-tutorial/favicon.ico">
    <meta name="description" content="大数据教程">
    <link rel="preload" href="/bigdata-tutorial/assets/css/0.styles.9b6772c9.css" as="style"><link rel="preload" href="/bigdata-tutorial/assets/js/app.9e86c55f.js" as="script"><link rel="preload" href="/bigdata-tutorial/assets/js/4.6e5a58a7.js" as="script"><link rel="preload" href="/bigdata-tutorial/assets/js/44.50436166.js" as="script"><link rel="preload" href="/bigdata-tutorial/assets/js/5.97e60065.js" as="script"><link rel="prefetch" href="/bigdata-tutorial/assets/js/10.b18536f5.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/11.d45305ad.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/12.f7ba974a.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/13.3fb367cb.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/14.f9ba6e81.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/15.92fa8d15.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/16.03a706f1.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/17.4240ccc4.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/18.47724a3c.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/19.893cd0e1.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/20.0f9c85d2.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/21.acc7f149.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/22.661a4c0a.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/23.81ddc809.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/24.86cf02b7.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/25.1a925ec5.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/26.44a7e88b.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/27.02160541.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/28.f81d3aba.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/29.e3c8d4f1.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/30.dea331c0.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/31.3a150281.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/32.8d690ba0.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/33.1f32bcf1.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/34.45338a6d.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/35.e505a47e.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/36.5751c2c9.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/37.1270bfe7.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/38.3b5d01fa.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/39.f8cf867c.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/40.9f18e62f.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/41.10eace07.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/42.fd96f2b1.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/43.d77fd497.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/45.9f6de474.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/46.65d98cbf.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/47.8c2d3205.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/6.dd9aa758.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/7.ac8df731.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/8.83a9d945.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/9.c01c4b35.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/vendors~flowchart.8982e116.js"><link rel="prefetch" href="/bigdata-tutorial/assets/js/vendors~notification.f509967c.js">
    <link rel="stylesheet" href="/bigdata-tutorial/assets/css/0.styles.9b6772c9.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/bigdata-tutorial/" class="home-link router-link-active"><img src="images/dunwu-logo-100.png" alt="BIGDATA-TUTORIAL" class="logo"> <span class="site-name can-hide">BIGDATA-TUTORIAL</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/bigdata-tutorial/hive/" class="nav-link">
  Hive
</a></div><div class="nav-item"><a href="/bigdata-tutorial/hdfs/" class="nav-link">
  Hdfs
</a></div><div class="nav-item"><a href="/bigdata-tutorial/hbase/" class="nav-link">
  Hbase
</a></div><div class="nav-item"><a href="/bigdata-tutorial/zookeeper/" class="nav-link router-link-active">
  ZooKeeper
</a></div><div class="nav-item"><a href="/bigdata-tutorial/kafka/" class="nav-link">
  Kafka
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><span class="title">✨ Java系列</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://dunwu.github.io/java-tutorial/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Java 教程 📚
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://dunwu.github.io/bigdata-tutorial/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  JavaCore 教程 📚
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://dunwu.github.io/bigdata-tutorial/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  JavaTech 教程 📚
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://dunwu.github.io/spring-tutorial/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Spring 教程 📚
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://dunwu.github.io/spring-boot-tutorial/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Spring Boot 教程 📚
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div><div class="nav-item"><a href="https://github.com/dunwu/blog" target="_blank" rel="noopener noreferrer" class="nav-link external">
  🎯 博客
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/dunwu/bigdata-tutorial" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/bigdata-tutorial/hive/" class="nav-link">
  Hive
</a></div><div class="nav-item"><a href="/bigdata-tutorial/hdfs/" class="nav-link">
  Hdfs
</a></div><div class="nav-item"><a href="/bigdata-tutorial/hbase/" class="nav-link">
  Hbase
</a></div><div class="nav-item"><a href="/bigdata-tutorial/zookeeper/" class="nav-link router-link-active">
  ZooKeeper
</a></div><div class="nav-item"><a href="/bigdata-tutorial/kafka/" class="nav-link">
  Kafka
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><span class="title">✨ Java系列</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://dunwu.github.io/java-tutorial/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Java 教程 📚
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://dunwu.github.io/bigdata-tutorial/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  JavaCore 教程 📚
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://dunwu.github.io/bigdata-tutorial/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  JavaTech 教程 📚
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://dunwu.github.io/spring-tutorial/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Spring 教程 📚
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://dunwu.github.io/spring-boot-tutorial/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Spring Boot 教程 📚
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div><div class="nav-item"><a href="https://github.com/dunwu/blog" target="_blank" rel="noopener noreferrer" class="nav-link external">
  🎯 博客
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/dunwu/bigdata-tutorial" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>ZooKeeper Java API</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/bigdata-tutorial/zookeeper/zookeeper-api.html#client-api-简介" class="sidebar-link">Client API 简介</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/bigdata-tutorial/zookeeper/zookeeper-api.html#引入依赖" class="sidebar-link">引入依赖</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/bigdata-tutorial/zookeeper/zookeeper-api.html#连接-zookeeper" class="sidebar-link">连接 ZooKeeper</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/bigdata-tutorial/zookeeper/zookeeper-api.html#创建-znode" class="sidebar-link">创建 znode</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/bigdata-tutorial/zookeeper/zookeeper-api.html#删除-znode" class="sidebar-link">删除 Znode</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/bigdata-tutorial/zookeeper/zookeeper-api.html#检查-znode-是否存在" class="sidebar-link">检查 znode 是否存在</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/bigdata-tutorial/zookeeper/zookeeper-api.html#getdata-方法" class="sidebar-link">getData 方法</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/bigdata-tutorial/zookeeper/zookeeper-api.html#setdata-方法" class="sidebar-link">setData 方法</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/bigdata-tutorial/zookeeper/zookeeper-api.html#getchildren-方法" class="sidebar-link">getChildren 方法</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/bigdata-tutorial/zookeeper/zookeeper-api.html#参考资料" class="sidebar-link">参考资料</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="zookeeper-java-api"><a href="#zookeeper-java-api" class="header-anchor">#</a> ZooKeeper Java API</h1> <blockquote><p><strong>ZooKeeper 是一个分布式应用协调服务</strong> ，由 Apache 进行维护。</p> <p>ZooKeeper 可以用于发布/订阅、负载均衡、命令服务、分布式协调/通知、集群管理、Master 选举、分布式锁和分布式队列等功能 。</p> <p>ZooKeeper 官方支持 Java 和 C 的 Client API。ZooKeeper 社区为大多数语言（.NET，python 等）提供非官方 API。</p></blockquote> <h2 id="client-api-简介"><a href="#client-api-简介" class="header-anchor">#</a> Client API 简介</h2> <p>客户端和服务端交互遵循以下基本步骤：</p> <ol><li>客户端连接 ZooKeeper 服务端集群任意工作节点，该节点为客户端分配会话 ID。</li> <li>为了保持通信，客户端需要和服务端保持心跳（实质上就是 ping ）。否则，ZooKeeper 服务会话超时时间内未收到客户端请求，会将会话视为过期。这种情况下，客户端如果要通信，就需要重新连接。</li> <li>只要会话 ID 处于活动状态，就可以执行读写 znode 操作。</li> <li>所有任务完成后，客户端断开与 ZooKeeper 服务端集群的连接。如果客户端长时间不活动，则 ZooKeeper 集合将自动断开客户端。</li></ol> <p>ZooKeeper Client API 的核心是 <strong><code>ZooKeeper</code> 类</strong>。它在其构造函数中提供了连接 ZooKeeper 服务的配置选项，并提供了访问 ZooKeeper 数据的方法。</p> <blockquote><p>其主要操作如下：</p> <ul><li><strong><code>connect</code></strong> - 连接 ZooKeeper 服务</li> <li><strong><code>create</code></strong> - 创建 znode</li> <li><strong><code>exists</code></strong> - 检查 znode 是否存在及其信息</li> <li><strong><code>getACL</code></strong> / <strong><code>setACL</code></strong>- 获取/设置一个 znode 的 ACL</li> <li><strong><code>getData</code></strong> / <strong><code>setData</code></strong>- 获取/设置一个 znode 的数据</li> <li><strong><code>getChildren</code></strong> - 获取特定 znode 中的所有子节点</li> <li><strong><code>delete</code></strong> - 删除特定的 znode 及其所有子项</li> <li><strong><code>close</code></strong> - 关闭连接</li></ul></blockquote> <h2 id="引入依赖"><a href="#引入依赖" class="header-anchor">#</a> 引入依赖</h2> <p>maven 项目使用 ZooKeeper Client，只需在 pom.xml 中添加：</p> <div class="language-xml extra-class"><pre class="language-xml"><code>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.curator<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>curator-recipes<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>4.2.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h2 id="连接-zookeeper"><a href="#连接-zookeeper" class="header-anchor">#</a> 连接 ZooKeeper</h2> <p>ZooKeeper 类通过其构造函数提供连接 ZooKeeper 服务的功能。其构造函数的定义如下：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">ZooKeeper</span><span class="token punctuation">(</span><span class="token class-name">String</span> connectionString<span class="token punctuation">,</span> <span class="token keyword">int</span> sessionTimeout<span class="token punctuation">,</span> <span class="token class-name">Watcher</span> watcher<span class="token punctuation">)</span>
</code></pre></div><blockquote><p>参数说明：</p> <ul><li><strong><code>connectionString</code></strong> - ZooKeeper 集群的主机列表。</li> <li><strong><code>sessionTimeout</code></strong> - 会话超时时间（以毫秒为单位）。</li> <li><strong>watcher</strong> - 实现监视机制的回调。当被监控的 znode 状态发生变化时，ZooKeeper 服务端的 <code>WatcherManager</code> 会主动调用传入的 Watcher ，推送状态变化给客户端。</li></ul></blockquote> <p>让我们创建一个新的帮助类 <strong>ZooKeeperConnection</strong> ，并添加一个方法 <strong>connect</strong> 。 <strong>connect</strong> 方法创建一个 ZooKeeper 对象，连接到 ZooKeeper 集合，然后返回对象。</p> <p>这里 <strong>CountDownLatch</strong> 用于停止（等待）主进程，直到客户端与 ZooKeeper 集合连接。</p> <p>ZooKeeper 集合通过监视器回调来回复连接状态。一旦客户端与 ZooKeeper 集合连接，监视器回调就会被调用，并且监视器回调函数调用<strong>CountDownLatch</strong>的<strong>countDown</strong>方法来释放锁，在主进程中<strong>await</strong>。</p> <p>以下是与 ZooKeeper 集合连接的完整代码。</p> <p>示例：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// import java classes</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io</span><span class="token punctuation">.</span><span class="token class-name">IOException</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent</span><span class="token punctuation">.</span><span class="token class-name">CountDownLatch</span><span class="token punctuation">;</span>

<span class="token comment">// import zookeeper classes</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>zookeeper</span><span class="token punctuation">.</span><span class="token class-name">KeeperException</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>zookeeper</span><span class="token punctuation">.</span><span class="token class-name">WatchedEvent</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>zookeeper</span><span class="token punctuation">.</span><span class="token class-name">Watcher</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>zookeeper</span><span class="token punctuation">.</span><span class="token class-name">Watcher</span><span class="token punctuation">.</span><span class="token class-name">Event</span><span class="token punctuation">.</span><span class="token class-name">KeeperState</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>zookeeper</span><span class="token punctuation">.</span><span class="token class-name">ZooKeeper</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>zookeeper</span><span class="token punctuation">.</span><span class="token class-name">AsyncCallback</span><span class="token punctuation">.</span><span class="token class-name">StatCallback</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>zookeeper</span><span class="token punctuation">.</span><span class="token class-name">KeeperException</span><span class="token punctuation">.</span><span class="token class-name">Code</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>zookeeper<span class="token punctuation">.</span>data</span><span class="token punctuation">.</span><span class="token class-name">Stat</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ZooKeeperConnection</span> <span class="token punctuation">{</span>

   <span class="token comment">// declare zookeeper instance to access ZooKeeper ensemble</span>
   <span class="token keyword">private</span> <span class="token class-name">ZooKeeper</span> zoo<span class="token punctuation">;</span>
   <span class="token keyword">final</span> <span class="token class-name">CountDownLatch</span> connectedSignal <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CountDownLatch</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

   <span class="token comment">// Method to connect zookeeper ensemble.</span>
   <span class="token keyword">public</span> <span class="token class-name">ZooKeeper</span> <span class="token function">connect</span><span class="token punctuation">(</span><span class="token class-name">String</span> host<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span><span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>

      zoo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ZooKeeper</span><span class="token punctuation">(</span>host<span class="token punctuation">,</span><span class="token number">5000</span><span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token class-name">Watcher</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

         <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">process</span><span class="token punctuation">(</span><span class="token class-name">WatchedEvent</span> we<span class="token punctuation">)</span> <span class="token punctuation">{</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span>we<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">KeeperState</span><span class="token punctuation">.</span><span class="token class-name">SyncConnected</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
               connectedSignal<span class="token punctuation">.</span><span class="token function">countDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
         <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      connectedSignal<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> zoo<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token comment">// Method to disconnect from zookeeper server</span>
   <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
      zoo<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>保存上面的代码，它将在下一节中用于连接 ZooKeeper 集合。</p> <h2 id="创建-znode"><a href="#创建-znode" class="header-anchor">#</a> 创建 znode</h2> <p>ZooKeeper 类提供了在 ZooKeeper 集合中创建一个新的 znode 的 <strong><code>create</code></strong> 方法。 <strong>create</strong> 方法的签名如下：</p> <div class="language- extra-class"><pre class="language-text"><code>create(String path, byte[] data, List&lt;ACL&gt; acl, CreateMode createMode)
</code></pre></div><ul><li><strong>path</strong> - Znode 路径。例如，/myapp1，/myapp2，/myapp1/mydata1，myapp2/mydata1/myanothersubdata</li> <li><strong>data</strong> - 要存储在指定 znode 路径中的数据</li> <li><strong>acl</strong> - 要创建的节点的访问控制列表。ZooKeeper API 提供了一个静态接口 <strong>ZooDefs.Ids</strong> 来获取一些基本的 acl 列表。例如，ZooDefs.Ids.OPEN_ACL_UNSAFE 返回打开 znode 的 acl 列表。</li> <li><strong>createMode</strong> - 节点的类型，即临时，顺序或两者。这是一个<strong>枚举</strong>。</li></ul> <p>让我们创建一个新的 Java 应用程序来检查 ZooKeeper API 的 <strong>create</strong> 功能。创建文件 <strong>ZKCreate.java</strong> 。在 main 方法中，创建一个类型为 <strong>ZooKeeperConnection</strong> 的对象，并调用 <strong>connect</strong> 方法连接到 ZooKeeper 集合。</p> <p>connect 方法将返回 ZooKeeper 对象 <strong>zk</strong> 。现在，请使用自定义<strong>path</strong>和<strong>data</strong>调用 <strong>zk</strong> 对象的 <strong>create</strong> 方法。</p> <p>创建 znode 的完整程序代码如下：</p> <p>示例：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io</span><span class="token punctuation">.</span><span class="token class-name">IOException</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>zookeeper</span><span class="token punctuation">.</span><span class="token class-name">WatchedEvent</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>zookeeper</span><span class="token punctuation">.</span><span class="token class-name">Watcher</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>zookeeper</span><span class="token punctuation">.</span><span class="token class-name">Watcher</span><span class="token punctuation">.</span><span class="token class-name">Event</span><span class="token punctuation">.</span><span class="token class-name">KeeperState</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>zookeeper</span><span class="token punctuation">.</span><span class="token class-name">ZooKeeper</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>zookeeper</span><span class="token punctuation">.</span><span class="token class-name">KeeperException</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>zookeeper</span><span class="token punctuation">.</span><span class="token class-name">CreateMode</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>zookeeper</span><span class="token punctuation">.</span><span class="token class-name">ZooDefs</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ZKCreate</span> <span class="token punctuation">{</span>
   <span class="token comment">// create static instance for zookeeper class.</span>
   <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">ZooKeeper</span> zk<span class="token punctuation">;</span>

   <span class="token comment">// create static instance for ZooKeeperConnection class.</span>
   <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">ZooKeeperConnection</span> conn<span class="token punctuation">;</span>

   <span class="token comment">// Method to create znode in zookeeper ensemble</span>
   <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">create</span><span class="token punctuation">(</span><span class="token class-name">String</span> path<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> data<span class="token punctuation">)</span> <span class="token keyword">throws</span>
      <span class="token class-name">KeeperException</span><span class="token punctuation">,</span><span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
      zk<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> data<span class="token punctuation">,</span> <span class="token class-name">ZooDefs</span><span class="token punctuation">.</span><span class="token class-name">Ids</span><span class="token punctuation">.</span>OPEN_ACL_UNSAFE<span class="token punctuation">,</span>
      <span class="token class-name">CreateMode</span><span class="token punctuation">.</span>PERSISTENT<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>

      <span class="token comment">// znode path</span>
      <span class="token class-name">String</span> path <span class="token operator">=</span> <span class="token string">&quot;/MyFirstZnode&quot;</span><span class="token punctuation">;</span> <span class="token comment">// Assign path to znode</span>

      <span class="token comment">// data in byte array</span>
      <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> data <span class="token operator">=</span> <span class="token string">&quot;My first zookeeper app&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Declare data</span>

      <span class="token keyword">try</span> <span class="token punctuation">{</span>
         conn <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ZooKeeperConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         zk <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">&quot;localhost&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token function">create</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Create the data to the specified path</span>
         conn<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//Catch error message</span>
      <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>一旦编译和执行应用程序，将在 ZooKeeper 集合中创建具有指定数据的 znode。你可以使用 ZooKeeper CLI <strong>zkCli.sh</strong> 进行检查。</p> <div class="language- extra-class"><pre class="language-text"><code>cd /path/to/zookeeper
bin/zkCli.sh
&gt;&gt;&gt; get /MyFirstZnode
</code></pre></div><h2 id="删除-znode"><a href="#删除-znode" class="header-anchor">#</a> 删除 Znode</h2> <p>ZooKeeper 类提供了 <strong>delete</strong> 方法来删除指定的 znode。 <strong>delete</strong> 方法的签名如下：</p> <div class="language- extra-class"><pre class="language-text"><code>delete(String path, int version)
</code></pre></div><ul><li><strong>path</strong> - Znode 路径。</li> <li><strong>version</strong> - znode 的当前版本。</li></ul> <p>让我们创建一个新的 Java 应用程序来了解 ZooKeeper API 的 <strong>delete</strong> 功能。创建文件 <strong>ZKDelete.java</strong> 。在 main 方法中，使用 <strong>ZooKeeperConnection</strong> 对象创建一个 ZooKeeper 对象 <strong>zk</strong> 。然后，使用指定的路径和版本号调用 <strong>zk</strong> 对象的 <strong>delete</strong> 方法。</p> <p>删除 znode 的完整程序代码如下：</p> <p>示例：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>zookeeper</span><span class="token punctuation">.</span><span class="token class-name">ZooKeeper</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>zookeeper</span><span class="token punctuation">.</span><span class="token class-name">KeeperException</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ZKDelete</span> <span class="token punctuation">{</span>
   <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">ZooKeeper</span> zk<span class="token punctuation">;</span>
   <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">ZooKeeperConnection</span> conn<span class="token punctuation">;</span>

   <span class="token comment">// Method to check existence of znode and its status, if znode is available.</span>
   <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">delete</span><span class="token punctuation">(</span><span class="token class-name">String</span> path<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">KeeperException</span><span class="token punctuation">,</span><span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
      zk<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span>zk<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getVersion</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span><span class="token punctuation">,</span><span class="token class-name">KeeperException</span> <span class="token punctuation">{</span>
      <span class="token class-name">String</span> path <span class="token operator">=</span> <span class="token string">&quot;/MyFirstZnode&quot;</span><span class="token punctuation">;</span> <span class="token comment">//Assign path to the znode</span>

      <span class="token keyword">try</span> <span class="token punctuation">{</span>
         conn <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ZooKeeperConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         zk <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">&quot;localhost&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token function">delete</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//delete the node with the specified path</span>
      <span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// catches error messages</span>
      <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="检查-znode-是否存在"><a href="#检查-znode-是否存在" class="header-anchor">#</a> 检查 znode 是否存在</h2> <p>ZooKeeper 类提供了 <strong>exists</strong> 方法来检查 znode 的存在。如果指定的 znode 存在，则返回一个 znode 的元数据。<strong>exists</strong>方法的签名如下：</p> <div class="language- extra-class"><pre class="language-text"><code>exists(String path, boolean watcher)
</code></pre></div><ul><li><strong>path</strong>- Znode 路径</li> <li><strong>watcher</strong> - 布尔值，用于指定是否监视指定的 znode</li></ul> <p>让我们创建一个新的 Java 应用程序来检查 ZooKeeper API 的“exists”功能。创建文件“ZKExists.java”。在 main 方法中，使用“ZooKeeperConnection”对象创建 ZooKeeper 对象“zk”。然后，使用自定义“path”调用“zk”对象的“exists”方法。完整的列表如下：</p> <p>示例：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io</span><span class="token punctuation">.</span><span class="token class-name">IOException</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>zookeeper</span><span class="token punctuation">.</span><span class="token class-name">ZooKeeper</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>zookeeper</span><span class="token punctuation">.</span><span class="token class-name">KeeperException</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>zookeeper</span><span class="token punctuation">.</span><span class="token class-name">WatchedEvent</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>zookeeper</span><span class="token punctuation">.</span><span class="token class-name">Watcher</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>zookeeper</span><span class="token punctuation">.</span><span class="token class-name">Watcher</span><span class="token punctuation">.</span><span class="token class-name">Event</span><span class="token punctuation">.</span><span class="token class-name">KeeperState</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>zookeeper<span class="token punctuation">.</span>data</span><span class="token punctuation">.</span><span class="token class-name">Stat</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ZKExists</span> <span class="token punctuation">{</span>
   <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">ZooKeeper</span> zk<span class="token punctuation">;</span>
   <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">ZooKeeperConnection</span> conn<span class="token punctuation">;</span>

   <span class="token comment">// Method to check existence of znode and its status, if znode is available.</span>
   <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Stat</span> <span class="token function">znode_exists</span><span class="token punctuation">(</span><span class="token class-name">String</span> path<span class="token punctuation">)</span> <span class="token keyword">throws</span>
      <span class="token class-name">KeeperException</span><span class="token punctuation">,</span><span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> zk<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span><span class="token punctuation">,</span><span class="token class-name">KeeperException</span> <span class="token punctuation">{</span>
      <span class="token class-name">String</span> path <span class="token operator">=</span> <span class="token string">&quot;/MyFirstZnode&quot;</span><span class="token punctuation">;</span> <span class="token comment">// Assign znode to the specified path</span>

      <span class="token keyword">try</span> <span class="token punctuation">{</span>
         conn <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ZooKeeperConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         zk <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">&quot;localhost&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token class-name">Stat</span> stat <span class="token operator">=</span> <span class="token function">znode_exists</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Stat checks the path of the znode</span>

         <span class="token keyword">if</span><span class="token punctuation">(</span>stat <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Node exists and the node version is &quot;</span> <span class="token operator">+</span>
            stat<span class="token punctuation">.</span><span class="token function">getVersion</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Node does not exists&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>

      <span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Catches error messages</span>
      <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>一旦编译和执行应用程序，你将获得以下输出。</p> <div class="language- extra-class"><pre class="language-text"><code>Node exists and the node version is 1.
</code></pre></div><h2 id="getdata-方法"><a href="#getdata-方法" class="header-anchor">#</a> getData 方法</h2> <p>ZooKeeper 类提供 <strong>getData</strong> 方法来获取附加在指定 znode 中的数据及其状态。 <strong>getData</strong> 方法的签名如下：</p> <div class="language- extra-class"><pre class="language-text"><code>getData(String path, Watcher watcher, Stat stat)
</code></pre></div><ul><li><strong>path</strong> - Znode 路径。</li> <li><strong>watcher</strong> - 监视器类型的回调函数。当指定的 znode 的数据改变时，ZooKeeper 集合将通过监视器回调进行通知。这是一次性通知。</li> <li><strong>stat</strong> - 返回 znode 的元数据。</li></ul> <p>让我们创建一个新的 Java 应用程序来了解 ZooKeeper API 的 <strong>getData</strong> 功能。创建文件 <strong>ZKGetData.java</strong> 。在 main 方法中，使用 <strong>ZooKeeperConnection</strong> 对象创建一个 ZooKeeper 对象 <strong>zk</strong> 。然后，使用自定义路径调用 zk 对象的 <strong>getData</strong> 方法。</p> <p>下面是从指定节点获取数据的完整程序代码：</p> <p>示例：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io</span><span class="token punctuation">.</span><span class="token class-name">IOException</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent</span><span class="token punctuation">.</span><span class="token class-name">CountDownLatch</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>zookeeper</span><span class="token punctuation">.</span><span class="token class-name">ZooKeeper</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>zookeeper</span><span class="token punctuation">.</span><span class="token class-name">KeeperException</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>zookeeper</span><span class="token punctuation">.</span><span class="token class-name">WatchedEvent</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>zookeeper</span><span class="token punctuation">.</span><span class="token class-name">Watcher</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>zookeeper</span><span class="token punctuation">.</span><span class="token class-name">Watcher</span><span class="token punctuation">.</span><span class="token class-name">Event</span><span class="token punctuation">.</span><span class="token class-name">KeeperState</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>zookeeper<span class="token punctuation">.</span>data</span><span class="token punctuation">.</span><span class="token class-name">Stat</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ZKGetData</span> <span class="token punctuation">{</span>

   <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">ZooKeeper</span> zk<span class="token punctuation">;</span>
   <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">ZooKeeperConnection</span> conn<span class="token punctuation">;</span>
   <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Stat</span> <span class="token function">znode_exists</span><span class="token punctuation">(</span><span class="token class-name">String</span> path<span class="token punctuation">)</span> <span class="token keyword">throws</span>
      <span class="token class-name">KeeperException</span><span class="token punctuation">,</span><span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> zk<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span><span class="token punctuation">,</span> <span class="token class-name">KeeperException</span> <span class="token punctuation">{</span>
      <span class="token class-name">String</span> path <span class="token operator">=</span> <span class="token string">&quot;/MyFirstZnode&quot;</span><span class="token punctuation">;</span>
      <span class="token keyword">final</span> <span class="token class-name">CountDownLatch</span> connectedSignal <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CountDownLatch</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">try</span> <span class="token punctuation">{</span>
         conn <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ZooKeeperConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         zk <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">&quot;localhost&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token class-name">Stat</span> stat <span class="token operator">=</span> <span class="token function">znode_exists</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>

         <span class="token keyword">if</span><span class="token punctuation">(</span>stat <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> b <span class="token operator">=</span> zk<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Watcher</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

               <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">process</span><span class="token punctuation">(</span><span class="token class-name">WatchedEvent</span> we<span class="token punctuation">)</span> <span class="token punctuation">{</span>

                  <span class="token keyword">if</span> <span class="token punctuation">(</span>we<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">Event</span><span class="token punctuation">.</span><span class="token class-name">EventType</span><span class="token punctuation">.</span><span class="token class-name">None</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                     <span class="token keyword">switch</span><span class="token punctuation">(</span>we<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token keyword">case</span> <span class="token class-name">Expired</span><span class="token operator">:</span>
                        connectedSignal<span class="token punctuation">.</span><span class="token function">countDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword">break</span><span class="token punctuation">;</span>
                     <span class="token punctuation">}</span>

                  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                     <span class="token class-name">String</span> path <span class="token operator">=</span> <span class="token string">&quot;/MyFirstZnode&quot;</span><span class="token punctuation">;</span>

                     <span class="token keyword">try</span> <span class="token punctuation">{</span>
                        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bn <span class="token operator">=</span> zk<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span>
                        <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token class-name">String</span> data <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>bn<span class="token punctuation">,</span>
                        <span class="token string">&quot;UTF-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        connectedSignal<span class="token punctuation">.</span><span class="token function">countDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                     <span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>ex<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                     <span class="token punctuation">}</span>
                  <span class="token punctuation">}</span>
               <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name">String</span> data <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span> <span class="token string">&quot;UTF-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
            connectedSignal<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

         <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Node does not exists&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
      <span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>一旦编译和执行应用程序，你将获得以下输出</p> <div class="language- extra-class"><pre class="language-text"><code>My first zookeeper app
</code></pre></div><p>应用程序将等待 ZooKeeper 集合的进一步通知。使用 ZooKeeper CLI <strong>zkCli.sh</strong> 更改指定 znode 的数据。</p> <div class="language- extra-class"><pre class="language-text"><code>cd /path/to/zookeeper
bin/zkCli.sh
&gt;&gt;&gt; set /MyFirstZnode Hello
</code></pre></div><p>现在，应用程序将打印以下输出并退出。</p> <div class="language- extra-class"><pre class="language-text"><code>Hello
</code></pre></div><h2 id="setdata-方法"><a href="#setdata-方法" class="header-anchor">#</a> setData 方法</h2> <p>ZooKeeper 类提供 <strong>setData</strong> 方法来修改指定 znode 中附加的数据。 <strong>setData</strong> 方法的签名如下：</p> <div class="language- extra-class"><pre class="language-text"><code>setData(String path, byte[] data, int version)
</code></pre></div><ul><li><strong>path</strong>- Znode 路径</li> <li><strong>data</strong> - 要存储在指定 znode 路径中的数据。</li> <li><strong>version</strong>- znode 的当前版本。每当数据更改时，ZooKeeper 会更新 znode 的版本号。</li></ul> <p>现在让我们创建一个新的 Java 应用程序来了解 ZooKeeper API 的 <strong>setData</strong> 功能。创建文件 <strong>ZKSetData.java</strong> 。在 main 方法中，使用 <strong>ZooKeeperConnection</strong> 对象创建一个 ZooKeeper 对象 <strong>zk</strong> 。然后，使用指定的路径，新数据和节点版本调用 <strong>zk</strong> 对象的 <strong>setData</strong> 方法。</p> <p>以下是修改附加在指定 znode 中的数据的完整程序代码。</p> <p>示例：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>zookeeper</span><span class="token punctuation">.</span><span class="token class-name">ZooKeeper</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>zookeeper</span><span class="token punctuation">.</span><span class="token class-name">KeeperException</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>zookeeper</span><span class="token punctuation">.</span><span class="token class-name">WatchedEvent</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>zookeeper</span><span class="token punctuation">.</span><span class="token class-name">Watcher</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>zookeeper</span><span class="token punctuation">.</span><span class="token class-name">Watcher</span><span class="token punctuation">.</span><span class="token class-name">Event</span><span class="token punctuation">.</span><span class="token class-name">KeeperState</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io</span><span class="token punctuation">.</span><span class="token class-name">IOException</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ZKSetData</span> <span class="token punctuation">{</span>
   <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">ZooKeeper</span> zk<span class="token punctuation">;</span>
   <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">ZooKeeperConnection</span> conn<span class="token punctuation">;</span>

   <span class="token comment">// Method to update the data in a znode. Similar to getData but without watcher.</span>
   <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token class-name">String</span> path<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> data<span class="token punctuation">)</span> <span class="token keyword">throws</span>
      <span class="token class-name">KeeperException</span><span class="token punctuation">,</span><span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
      zk<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> data<span class="token punctuation">,</span> zk<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getVersion</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span><span class="token punctuation">,</span><span class="token class-name">KeeperException</span> <span class="token punctuation">{</span>
      <span class="token class-name">String</span> path<span class="token operator">=</span> <span class="token string">&quot;/MyFirstZnode&quot;</span><span class="token punctuation">;</span>
      <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> data <span class="token operator">=</span> <span class="token string">&quot;Success&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//Assign data which is to be updated.</span>

      <span class="token keyword">try</span> <span class="token punctuation">{</span>
         conn <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ZooKeeperConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         zk <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">&quot;localhost&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token function">update</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Update znode data to the specified path</span>
      <span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>编译并执行应用程序后，指定的 znode 的数据将被改变，并且可以使用 ZooKeeper CLI <strong>zkCli.sh</strong> 进行检查。</p> <div class="language- extra-class"><pre class="language-text"><code>cd /path/to/zookeeper
bin/zkCli.sh
&gt;&gt;&gt; get /MyFirstZnode
</code></pre></div><h2 id="getchildren-方法"><a href="#getchildren-方法" class="header-anchor">#</a> getChildren 方法</h2> <p>ZooKeeper 类提供 <strong>getChildren</strong> 方法来获取特定 znode 的所有子节点。 <strong>getChildren</strong> 方法的签名如下：</p> <div class="language- extra-class"><pre class="language-text"><code>getChildren(String path, Watcher watcher)
</code></pre></div><ul><li><strong>path</strong> - Znode 路径。</li> <li><strong>watcher</strong> - 监视器类型的回调函数。当指定的 znode 被删除或 znode 下的子节点被创建/删除时，ZooKeeper 集合将进行通知。这是一次性通知。</li></ul> <p>示例：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io</span><span class="token punctuation">.</span><span class="token class-name">IOException</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>zookeeper</span><span class="token punctuation">.</span><span class="token class-name">ZooKeeper</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>zookeeper</span><span class="token punctuation">.</span><span class="token class-name">KeeperException</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>zookeeper</span><span class="token punctuation">.</span><span class="token class-name">WatchedEvent</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>zookeeper</span><span class="token punctuation">.</span><span class="token class-name">Watcher</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>zookeeper</span><span class="token punctuation">.</span><span class="token class-name">Watcher</span><span class="token punctuation">.</span><span class="token class-name">Event</span><span class="token punctuation">.</span><span class="token class-name">KeeperState</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>zookeeper<span class="token punctuation">.</span>data</span><span class="token punctuation">.</span><span class="token class-name">Stat</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ZKGetChildren</span> <span class="token punctuation">{</span>
   <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">ZooKeeper</span> zk<span class="token punctuation">;</span>
   <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">ZooKeeperConnection</span> conn<span class="token punctuation">;</span>

   <span class="token comment">// Method to check existence of znode and its status, if znode is available.</span>
   <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Stat</span> <span class="token function">znode_exists</span><span class="token punctuation">(</span><span class="token class-name">String</span> path<span class="token punctuation">)</span> <span class="token keyword">throws</span>
      <span class="token class-name">KeeperException</span><span class="token punctuation">,</span><span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> zk<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span><span class="token punctuation">,</span><span class="token class-name">KeeperException</span> <span class="token punctuation">{</span>
      <span class="token class-name">String</span> path <span class="token operator">=</span> <span class="token string">&quot;/MyFirstZnode&quot;</span><span class="token punctuation">;</span> <span class="token comment">// Assign path to the znode</span>

      <span class="token keyword">try</span> <span class="token punctuation">{</span>
         conn <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ZooKeeperConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         zk <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">&quot;localhost&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token class-name">Stat</span> stat <span class="token operator">=</span> <span class="token function">znode_exists</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Stat checks the path</span>

         <span class="token keyword">if</span><span class="token punctuation">(</span>stat<span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

            <span class="token comment">// getChildren method - get all the children of znode.It has two args, path and watch</span>
            <span class="token class-name">List</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> children <span class="token operator">=</span> zk<span class="token punctuation">.</span><span class="token function">getChildren</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> children<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>children<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//Print children's</span>
         <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Node does not exists&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>

      <span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>在运行程序之前，让我们使用 ZooKeeper CLI <strong>zkCli.sh</strong> 为 <strong>/MyFirstZnode</strong> 创建两个子节点。</p> <div class="language- extra-class"><pre class="language-text"><code>cd /path/to/zookeeper
bin/zkCli.sh
&gt;&gt;&gt; create /MyFirstZnode/myfirstsubnode Hi
&gt;&gt;&gt; create /MyFirstZnode/mysecondsubmode Hi
</code></pre></div><p>现在，编译和运行程序将输出上面创建的 znode。</p> <div class="language- extra-class"><pre class="language-text"><code>myfirstsubnode
mysecondsubnode
</code></pre></div><h2 id="参考资料"><a href="#参考资料" class="header-anchor">#</a> 参考资料</h2> <ul><li><strong>官方</strong> <ul><li><a href="http://zookeeper.apache.org/" target="_blank" rel="noopener noreferrer">ZooKeeper 官网<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://cwiki.apache.org/confluence/display/ZOOKEEPER" target="_blank" rel="noopener noreferrer">ZooKeeper 官方文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://github.com/apache/zookeeper" target="_blank" rel="noopener noreferrer">ZooKeeper Github<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li> <li><strong>书籍</strong> <ul><li><a href="https://item.jd.com/12109713.html" target="_blank" rel="noopener noreferrer">《Hadoop 权威指南（第四版）》<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li> <li><strong>文章</strong> <ul><li><a href="https://www.ibm.com/developerworks/cn/opensource/os-cn-zookeeper/index.html" target="_blank" rel="noopener noreferrer">分布式服务框架 ZooKeeper -- 管理分布式环境中的数据<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://www.cnblogs.com/felixzh/p/5869212.html" target="_blank" rel="noopener noreferrer">ZooKeeper 的功能以及工作原理<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://github.com/heibaiying/BigData-Notes/blob/master/notes/ZooKeeper%E7%AE%80%E4%BB%8B%E5%8F%8A%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5.md" target="_blank" rel="noopener noreferrer">ZooKeeper 简介及核心概念<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://draveness.me/zookeeper-chubby" target="_blank" rel="noopener noreferrer">详解分布式协调服务 ZooKeeper<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="http://www.jasongj.com/zookeeper/fastleaderelection/" target="_blank" rel="noopener noreferrer">深入浅出 Zookeeper（一） Zookeeper 架构及 FastLeaderElection 机制<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li></ul></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/dunwu/bigdata-tutorial/edit/master/docs/zookeeper/zookeeper-api.md" target="_blank" rel="noopener noreferrer">帮助我们改善此页面！</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <!----></footer> <!----> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/bigdata-tutorial/assets/js/app.9e86c55f.js" defer></script><script src="/bigdata-tutorial/assets/js/4.6e5a58a7.js" defer></script><script src="/bigdata-tutorial/assets/js/44.50436166.js" defer></script><script src="/bigdata-tutorial/assets/js/5.97e60065.js" defer></script>
  </body>
</html>
